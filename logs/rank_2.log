2026-01-22 19:31:07,389 - SpecSoT-Rank2 - INFO - [run_specsot.py:97] - 日志将保存到: /data/home/chenyu/Coding/SD+SoT/Speculative-Decoding-Enabled-Skeleton-of-Thought/logs/rank_2.log
2026-01-22 19:31:07,389 - SpecSoT-Rank2 - INFO - [run_specsot.py:285] - ============================================================
2026-01-22 19:31:07,389 - SpecSoT-Rank2 - INFO - [run_specsot.py:286] - SpecSoT Worker 启动
2026-01-22 19:31:07,389 - SpecSoT-Rank2 - INFO - [run_specsot.py:287] - ============================================================
2026-01-22 19:31:07,389 - SpecSoT-Rank2 - INFO - [run_specsot.py:288] - Base Model: /data/home/chenyu/Coding/SD+SoT/models/Qwen3-4B
2026-01-22 19:31:07,389 - SpecSoT-Rank2 - INFO - [run_specsot.py:289] - Eagle Model: /data/home/chenyu/Coding/SD+SoT/models/Qwen3-4B_eagle3
2026-01-22 19:31:07,389 - SpecSoT-Rank2 - INFO - [run_specsot.py:290] - Task: planning
2026-01-22 19:31:07,389 - SpecSoT-Rank2 - INFO - [run_specsot.py:291] - Enable Parallel: True
2026-01-22 19:31:07,389 - SpecSoT-Rank2 - INFO - [run_specsot.py:292] - Max New Tokens: 3000
2026-01-22 19:31:07,389 - SpecSoT-Rank2 - INFO - [run_specsot.py:293] - Random Seed: 76
2026-01-22 19:31:07,389 - SpecSoT-Rank2 - INFO - [run_specsot.py:296] - Distributed Mode: rank=2/2
2026-01-22 19:31:07,389 - SpecSoT-Rank2 - INFO - [run_specsot.py:297] - Layer Splits: 14,28
2026-01-22 19:31:07,389 - SpecSoT-Rank2 - INFO - [run_specsot.py:298] - Comm Mode: p2p
2026-01-22 19:31:07,389 - SpecSoT-Rank2 - INFO - [run_specsot.py:299] - Chunk Size: 128
2026-01-22 19:31:07,389 - SpecSoT-Rank2 - INFO - [run_specsot.py:300] - Base Port: 45000
2026-01-22 19:31:07,389 - SpecSoT-Rank2 - INFO - [run_specsot.py:301] - ============================================================
2026-01-22 19:31:07,389 - SpecSoT-Rank2 - INFO - [run_specsot.py:319] - 分布式配置: DistributedConfig(rank=2/2, layer_splits=[14, 28], comm_mode=p2p)
2026-01-22 19:31:07,389 - SpecSoT-Rank2 - INFO - [run_specsot.py:324] - >>> 正在加载 SpecSoT 模型...
2026-01-22 19:31:14,887 - SpecSoT-Rank2 - INFO - [run_specsot.py:341] - 模型加载完成，耗时: 7.50s
2026-01-22 19:31:14,889 - SpecSoT-Rank2 - INFO - [run_specsot.py:347] - Special Token IDs:
2026-01-22 19:31:14,889 - SpecSoT-Rank2 - DEBUG - [run_specsot.py:350] -   para_begin_token_id: 820 -> '####'
2026-01-22 19:31:14,890 - SpecSoT-Rank2 - DEBUG - [run_specsot.py:350] -   para_end_token_id: 5321 -> '%%%%'
2026-01-22 19:31:14,890 - SpecSoT-Rank2 - DEBUG - [run_specsot.py:350] -   ellipsis_token_id: 28149 -> '......'
2026-01-22 19:31:14,890 - SpecSoT-Rank2 - DEBUG - [run_specsot.py:350] -   half_ellipsis_token_id: 1112 -> '...'
2026-01-22 19:31:14,890 - SpecSoT-Rank2 - DEBUG - [run_specsot.py:350] -   line_break_token_id: 271 -> '

'
2026-01-22 19:31:14,891 - SpecSoT-Rank2 - DEBUG - [run_specsot.py:350] -   colon_token_id: 25 -> ':'
2026-01-22 19:31:14,891 - SpecSoT-Rank2 - DEBUG - [run_specsot.py:350] -   cn_colon_token_id: 5122 -> '：'
2026-01-22 19:31:14,891 - SpecSoT-Rank2 - DEBUG - [run_specsot.py:350] -   colon_new_line_token_id: 510 -> ':2026-01-22 19:31:14,900 - SpecSoT-Rank2 - INFO - [run_specsot.py:225] - 加载数据集: /data/home/chenyu/Coding/SD+SoT/Speculative-Decoding-Enabled-Skeleton-of-Thought/datasets/planning/industry_tasks_no_ascii.jsonl, 共 9 条样本
2026-01-22 19:31:14,900 - SpecSoT-Rank2 - INFO - [run_specsot.py:357] - 使用 1 条样本进行评估
2026-01-22 19:31:14,900 - SpecSoT-Rank2 - INFO - [run_specsot.py:372] - 
============================================================
2026-01-22 19:31:14,900 - SpecSoT-Rank2 - INFO - [run_specsot.py:373] - 样本 1/1: 请问打篮球时，如何提高投篮命中率？请给出详细的建议。...
2026-01-22 19:31:14,901 - SpecSoT-Rank2 - INFO - [run_specsot.py:374] - ============================================================
Usi2026-01-22 19:31:35,922 - SpecSoT-Rank2 - INFO - [run_specsot.py:397] - 
[统计信息]
2026-01-22 19:31:35,922 - SpecSoT-Rank2 - INFO - [run_specsot.py:398] -   总耗时: 21.00s
2026-01-22 19:31:35,922 - SpecSoT-Rank2 - INFO - [run_specsot.py:399] -   峰值显存: 4422.19 MB
2026-01-22 19:31:35,922 - SpecSoT-Rank2 - INFO - [run_specsot.py:400] -   输出长度: 1901 tokens
2026-01-22 19:31:35,922 - SpecSoT-Rank2 - INFO - [run_specsot.py:401] -   吞吐量: 90.5 tokens/s
2026-01-22 19:31:35,922 - SpecSoT-Rank2 - INFO - [run_specsot.py:402] -   并行分支数: 5
2026-01-22 19:31:35,922 - SpecSoT-Rank2 - INFO - [run_specsot.py:403] -   平均接受长度: 0.53
2026-01-22 19:31:35,922 - SpecSoT-Rank2 - INFO - [run_specsot.py:404] -   平均Draft时间: 5.63 ms
2026-01-22 19:31:35,922 - SpecSoT-Rank2 - INFO - [run_specsot.py:405] -   平均Verify时间: 28.86 ms
2026-01-22 19:31:35,922 - SpecSoT-Rank2 - INFO - [run_specsot.py:406] -   平均Update时间: 1.07 ms
2026-01-22 19:31:35,922 - SpecSoT-Rank2 - INFO - [run_specsot.py:409] - 
[响应预览]
2026-01-22 19:31:35,922 - SpecSoT-Rank2 - INFO - [run_specsot.py:410] - 分析这个问题是否属于需要拆解规划的“复杂任务”：

问题要求“详细建议”，涉及多个独立的方面，如技术动作、训练方法、心理因素、场地条件等，这些部分可以并行考虑，因此属于复杂任务，必须拆解规划。

执行方法B，生成思维骨架：

#### 技术动作规范【212】:......

#### 训练计划制定【189】:......

#### 心理素质提升【199】:......

#### 场地与装备优化【156】:......

#### 比赛经验积累【204】:......

####%%%%

#### 技术动作规范【212】: 
正确的投篮姿势是保持身体平衡，双脚分开与肩同宽，膝盖微屈，重心放在前脚掌。出手时，手臂自然伸直，手腕下压，球从指尖弹出。练习时要注意保持手臂与身体成直线，避免过度弯曲或伸直。此外，投篮时的发力顺序也很重要，先蹬地，再转胯，最后出手，确保动作连贯。可以通过慢动作练习和录像回放来纠正错误动作，提高动作的准确性和稳定性。


#### 训练计划制定【189】: 
制定科学的训练计划是提高投篮命中率的关键。首先，要明确训练目标，例如提升远距离投篮能力或增强近距离投篮的...
2026-01-22 19:31:35,923 - SpecSoT-Rank2 - INFO - [run_specsot.py:464] - 正在清理分布式资源...
2026-01-22 19:31:36,029 - SpecSoT-Rank2 - INFO - [run_specsot.py:466] - 分布式资源已清理
2026-01-22 19:31:36,029 - SpecSoT-Rank2 - INFO - [run_specsot.py:468] - Worker 执行完成
uted_prefill.py:564] - [CHUNK 1/5] 完成 | 总耗时: 294.97ms
2026-01-22 19:31:15.228 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:287] - 
[CHUNK 2/5] 开始处理 | seq_len=128, first=False, last=False
2026-01-22 19:31:15.228 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:302] -   [PHASE 1] 等待接收 Hidden States (from Rank 1)...
2026-01-22 19:31:15.228 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:311] -   [PHASE 1][RECV] Hidden States | shape=(1, 128, 2560), dtype=float16, device=cuda:0, size=0.625MB | chunk_idx=1
2026-01-22 19:31:15.228 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:320] -   [PHASE 2] 开始计算 Decoder Layers [28, 36)
2026-01-22 19:31:15.246 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:434] -   [PHASE 2] 完成 | layers=8, cache_sent=16, eagle_hidden_sent=0 | 耗时: 18.18ms
2026-01-22 19:31:15.246 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:453] -   [PHASE 3] 执行 Eagle Layer 计算...
2026-01-22 19:31:15.247 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:464] -   [PHASE 3][RECV] 等待 Eagle Input Hidden States (chunk=1)...
2026-01-22 19:31:15.247 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:474] -   [PHASE 3][RECV] 收到 2 个 Eagle Hidden (chunk=1) | 耗时: 0.06ms
2026-01-22 19:31:15.252 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:530] -   [PHASE 3][BROADCAST] Eagle Stable KV | chunk=1, size=0.50MB
2026-01-22 19:31:15.253 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:564] - [CHUNK 2/5] 完成 | 总耗时: 25.13ms
2026-01-22 19:31:15.253 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:287] - 
[CHUNK 3/5] 开始处理 | seq_len=128, first=False, last=False
2026-01-22 19:31:15.253 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:302] -   [PHASE 1] 等待接收 Hidden States (from Rank 1)...
2026-01-22 19:31:15.253 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:311] -   [PHASE 1][RECV] Hidden States | shape=(1, 128, 2560), dtype=float16, device=cuda:0, size=0.625MB | chunk_idx=2
2026-01-22 19:31:15.253 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:320] -   [PHASE 2] 开始计算 Decoder Layers [28, 36)
2026-01-22 19:31:15.281 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:434] -   [PHASE 2] 完成 | layers=8, cache_sent=16, eagle_hidden_sent=0 | 耗时: 27.85ms
2026-01-22 19:31:15.281 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:453] -   [PHASE 3] 执行 Eagle Layer 计算...
2026-01-22 19:31:15.282 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:464] -   [PHASE 3][RECV] 等待 Eagle Input Hidden States (chunk=2)...
2026-01-22 19:31:15.282 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:474] -   [PHASE 3][RECV] 收到 2 个 Eagle Hidden (chunk=2) | 耗时: 0.18ms
2026-01-22 19:31:15.285 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:530] -   [PHASE 3][BROADCAST] Eagle Stable KV | chunk=2, size=0.50MB
2026-01-22 19:31:15.286 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:564] - [CHUNK 3/5] 完成 | 总耗时: 33.15ms
2026-01-22 19:31:15.286 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:287] - 
[CHUNK 4/5] 开始处理 | seq_len=128, first=False, last=False
2026-01-22 19:31:15.287 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:302] -   [PHASE 1] 等待接收 Hidden States (from Rank 1)...
2026-01-22 19:31:15.287 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:311] -   [PHASE 1][RECV] Hidden States | shape=(1, 128, 2560), dtype=float16, device=cuda:0, size=0.625MB | chunk_idx=3
2026-01-22 19:31:15.287 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:320] -   [PHASE 2] 开始计算 Decoder Layers [28, 36)
2026-01-22 19:31:15.310 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:434] -   [PHASE 2] 完成 | layers=8, cache_sent=16, eagle_hidden_sent=0 | 耗时: 23.31ms
2026-01-22 19:31:15.310 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:453] -   [PHASE 3] 执行 Eagle Layer 计算...
2026-01-22 19:31:15.311 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:464] -   [PHASE 3][RECV] 等待 Eagle Input Hidden States (chunk=3)...
2026-01-22 19:31:15.311 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:474] -   [PHASE 3][RECV] 收到 2 个 Eagle Hidden (chunk=3) | 耗时: 0.07ms
2026-01-22 19:31:15.314 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:530] -   [PHASE 3][BROADCAST] Eagle Stable KV | chunk=3, size=0.50MB
2026-01-22 19:31:15.315 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:564] - [CHUNK 4/5] 完成 | 总耗时: 28.93ms
2026-01-22 19:31:15.315 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:287] - 
[CHUNK 5/5] 开始处理 | seq_len=62, first=False, last=True
2026-01-22 19:31:15.315 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:302] -   [PHASE 1] 等待接收 Hidden States (from Rank 1)...
2026-01-22 19:31:15.315 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:311] -   [PHASE 1][RECV] Hidden States | shape=(1, 62, 2560), dtype=float16, device=cuda:0, size=0.303MB | chunk_idx=4
2026-01-22 19:31:15.316 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:320] -   [PHASE 2] 开始计算 Decoder Layers [28, 36)
2026-01-22 19:31:15.338 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:434] -   [PHASE 2] 完成 | layers=8, cache_sent=16, eagle_hidden_sent=0 | 耗时: 22.11ms
2026-01-22 19:31:15.338 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:453] -   [PHASE 3] 执行 Eagle Layer 计算...
2026-01-22 19:31:15.339 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:464] -   [PHASE 3][RECV] 等待 Eagle Input Hidden States (chunk=4)...
2026-01-22 19:31:15.339 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:474] -   [PHASE 3][RECV] 收到 2 个 Eagle Hidden (chunk=4) | 耗时: 0.13ms
2026-01-22 19:31:15.378 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:505] -   [PHASE 3] First Token 采样: 101042
2026-01-22 19:31:15.397 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:530] -   [PHASE 3][BROADCAST] Eagle Stable KV | chunk=4, size=0.24MB
2026-01-22 19:31:15.398 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:550] -   [PHASE 3][BROADCAST] Draft Tokens | shape=torch.Size([1, 40])
2026-01-22 19:31:15.398 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:555] -   [PHASE 3] Draft Tokens 广播完成
2026-01-22 19:31:15.399 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:564] - [CHUNK 5/5] 完成 | 总耗时: 83.99ms
2026-01-22 19:31:15.399 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:569] - 
============================================================
2026-01-22 19:31:15.400 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:570] - [POST-CHUNK] 所有 Chunks 处理完成，开始同步阶段
2026-01-22 19:31:15.400 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:571] - ============================================================
2026-01-22 19:31:15.400 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:628] - [SYNC] 最后一个 Rank 等待所有 Cache 同步...
2026-01-22 19:31:15.401 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:645] - [SYNC_OK] Rank 2 Cache 同步完成 | 耗时: 1.39ms
2026-01-22 19:31:15.402 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:654] - ============================================================
2026-01-22 19:31:15.402 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:655] - [PREFILL] 分布式 Prefill 完成 | 总耗时: 0.472s
2026-01-22 19:31:15.402 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:656] - ============================================================
Generated Skeleton: 分析这个问题是否属于需要拆解规划的“复杂任务”：

问题要求“详细建议”，涉及多个独立的方面，如技术动作、训练方法、心理因素、场地条件等，这些部分可以并行考虑，因此属于复杂任务，必须拆解规划。

执行方法B，生成思维骨架：

#### 技术动作规范【212】:......

#### 训练计划制定【189】:......

#### 心理素质提升【199】:......

#### 场地与装备优化【156】:......

#### 比赛经验积累【204】:......

####%%%%
Detected 5 parallel branches with predicted lengths: [200, 200, 200, 200, 200]
Parallel Decoding Step 1
Parallel Decoding Step 51
Branch 0 finished with EOS.
Parallel Decoding Step 101
Branch 1 finished with EOS.
Parallel Decoding Step 151
Parallel Decoding Step 201
Branch 4 finished with EOS.
Parallel Decoding Step 251
Parallel Decoding Step 301
Parallel Decoding Step 351
Parallel Decoding Step 401
Parallel Decoding Step 451
Branch 3 finished with EOS.
Branch 2 finished with EOS.
All branches finished generation.
Avg accepted lengths: 0.5254582484725051, Avg draft time: 0.0056s, Avg update time: 0.0011s, Avg verify time: 0.0289s
Branch 0 Length: 122
Branch 1 Length: 171
Branch 2 Length: 586
Branch 3 Length: 567
Branch 4 Length: 309
2026-01-22 19:31:35,922 - SpecSoT-Rank2 - INFO - [run_specsot.py:397] - 
[统计信息]
2026-01-22 19:31:35,922 - SpecSoT-Rank2 - INFO - [run_specsot.py:398] -   总耗时: 21.00s
2026-01-22 19:31:35,922 - SpecSoT-Rank2 - INFO - [run_specsot.py:399] -   峰值显存: 4422.19 MB
2026-01-22 19:31:35,922 - SpecSoT-Rank2 - INFO - [run_specsot.py:400] -   输出长度: 1901 tokens
2026-01-22 19:31:35,922 - SpecSoT-Rank2 - INFO - [run_specsot.py:401] -   吞吐量: 90.5 tokens/s
2026-01-22 19:31:35,922 - SpecSoT-Rank2 - INFO - [run_specsot.py:402] -   并行分支数: 5
2026-01-22 19:31:35,922 - SpecSoT-Rank2 - INFO - [run_specsot.py:403] -   平均接受长度: 0.53
2026-01-22 19:31:35,922 - SpecSoT-Rank2 - INFO - [run_specsot.py:404] -   平均Draft时间: 5.63 ms
2026-01-22 19:31:35,922 - SpecSoT-Rank2 - INFO - [run_specsot.py:405] -   平均Verify时间: 28.86 ms
2026-01-22 19:31:35,922 - SpecSoT-Rank2 - INFO - [run_specsot.py:406] -   平均Update时间: 1.07 ms
2026-01-22 19:31:35,922 - SpecSoT-Rank2 - INFO - [run_specsot.py:409] - 
[响应预览]
2026-01-22 19:31:35,922 - SpecSoT-Rank2 - INFO - [run_specsot.py:410] - 分析这个问题是否属于需要拆解规划的“复杂任务”：

问题要求“详细建议”，涉及多个独立的方面，如技术动作、训练方法、心理因素、场地条件等，这些部分可以并行考虑，因此属于复杂任务，必须拆解规划。

执行方法B，生成思维骨架：

#### 技术动作规范【212】:......

#### 训练计划制定【189】:......

#### 心理素质提升【199】:......

#### 场地与装备优化【156】:......

#### 比赛经验积累【204】:......

####%%%%

#### 技术动作规范【212】: 
正确的投篮姿势是保持身体平衡，双脚分开与肩同宽，膝盖微屈，重心放在前脚掌。出手时，手臂自然伸直，手腕下压，球从指尖弹出。练习时要注意保持手臂与身体成直线，避免过度弯曲或伸直。此外，投篮时的发力顺序也很重要，先蹬地，再转胯，最后出手，确保动作连贯。可以通过慢动作练习和录像回放来纠正错误动作，提高动作的准确性和稳定性。


#### 训练计划制定【189】: 
制定科学的训练计划是提高投篮命中率的关键。首先，要明确训练目标，例如提升远距离投篮能力或增强近距离投篮的...
2026-01-22 19:31:35,923 - SpecSoT-Rank2 - INFO - [run_specsot.py:464] - 正在清理分布式资源...
2026-01-22 19:31:35.923 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:206] - [CLEANUP] 通信统计: {'draft_tokens_sent': 2, 'draft_tokens_recv': 0, 'hidden_sent': 0, 'hidden_recv': 5, 'eagle_input_hidden_sent': 0, 'eagle_input_hidden_recv': 10, 'base_cache_sent': 80, 'base_cache_recv': 140, 'eagle_cache_sent': 10, 'eagle_cache_recv': 0, 'aggregated_sends': 0, 'forwarded_messages': 0}
2026-01-22 19:31:36.029 - DistPrefill-Rank2 - INFO - [distributed_prefill.py:209] - [CLEANUP] 分布式Prefill管理器已清理
2026-01-22 19:31:36,029 - SpecSoT-Rank2 - INFO - [run_specsot.py:466] - 分布式资源已清理
2026-01-22 19:31:36,029 - SpecSoT-Rank2 - INFO - [run_specsot.py:468] - Worker 执行完成
